<!DOCCTYPE html>

<!-- 
?videoid=<youtube video id>&start=<starttime>&end=<endtime>
-->

<html>

<body>
  <h1>
      Drill
    </h1>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player"></div>
  <script>

  // 2. This code loads the IFrame Player API code asynchronously.
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // 3. This function creates an <iframe> (and YouTube player)
  //    after the API code downloads.
  var player;

var urlParams = new URLSearchParams(window.location.search);

console.log(urlParams.has('post')); // true
console.log(urlParams.get('action')); // "edit"
console.log(urlParams.getAll('action')); // ["edit"]
console.log(urlParams.toString()); // "?post=1234&action=edit"
console.log(urlParams.append('active', '1')); // "?post=1234&action=edit&active=1"


  function onYouTubeIframeAPIReady() {
    console.log('onYouTubeIframeAPIReady')
    player = new YT.Player('player', {
      height: '390',
      width: '640',
      videoId: urlParams.get('videoid'),  //pGvl-gO319g',
      playervars: {
        start: urlParams.get('start'),  //34
        end: urlParams.get('end'),      //39,
        version: 3
      },
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  // 4. The API will call this function when the video player is ready.
  function onPlayerReady(event) {
    console.log('onPlayerReady')
    event.target.mute();
    event.target.seekTo( +urlParams.get('start'), false);
    event.target.playVideo();

    console.log(event.target);
  }

  // 5. The API calls this function when the player's state changes.
  //    The function indicates that when playing a video (state=1),
  //    the player should play for six seconds and then stop.
  var done = false;

  var videoDuration = 1000*(urlParams.get('end')-urlParams.get('start'))+1000
  console.log('videoDuration: ',videoDuration)

  function onPlayerStateChange(event) {
    console.log('onPlayerStateChange<DEBUG> event: ',event)

    if (event.data == YT.PlayerState.PLAYING && !done) {
      setTimeout(stopVideo, +videoDuration);
      done = true;
    }
  }

  function stopVideo() {
    console.log('stopVideo')
    player.stopVideo();
    player.seekTo( +urlParams.get('start'), false);
    setTimeout(stopVideo, +videoDuration);
  }

  </script>
</body>

</html>
